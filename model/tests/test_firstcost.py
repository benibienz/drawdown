"""Tests for firstcost.py."""

import advanced_controls

import pandas as pd
from model import firstcost

def test_soln_pds_install_cost_per_iunit_SolarPV_27Aug18():
  """Test PDS install cost per unit

     Values taken from SolarPVUtility_RRS_ELECGEN_v1.1d_27Aug18
  """
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_pds_tot_iunits_req = pd.Series([
      0.061158144891382, 0.0956963287565992, 0.147709178675075,
      0.208131559430844, 0.276585853638905, 0.352694443914253,
      0.355112754893078, 0.526364043126798, 0.623169817293988,
      0.726119417988453, 0.834835227825188, 0.866279647028161,
      1.06805500538546, 1.19180373833898, 1.31980821089477,
      1.4516908056678, 1.65078562297544, 1.72557989232562,
      1.8668311494404, 2.01045005923242, 2.15605900431668,
      2.30328036730816, 2.45173653082188, 2.60104987747283,
      2.75084278987599, 2.90073765064638, 3.07612351532151,
      3.1993227477488, 3.34725774931083, 3.49378422970006,
      3.6385245715315, 3.78110115742013, 3.92113636998096,
      4.05825259182899, 4.1920722055792, 4.3222175938466,
      4.43499993794447, 4.56997522439294, 4.68683223190188,
      4.79850454438799, 4.90461454446626, 5.00478461475171,
      5.09863713785931, 5.18579449640408, 5.265879073001,
      5.33851325026507, 5.40331941081129
      ], index=pd.RangeIndex(start=2014, stop=2061))
  expected_soln_pds_install_cost_per_iunit = pd.Series([
      # added a 2014 value, the rest are from Excel
      1663888168616.12, 1444939544214.85, 1260211854559.48,
      1131125771261.71, 1034176540754.27, 957914360042.17,
      955853826404.52, 844363092072.89, 800615041745.80,
      762954261503.24, 730136123170.93, 721678325520.19,
      675595934758.92, 652654395751.15, 632005749879.43,
      613318626692.05, 588974654797.70, 580807336513.56,
      566583683816.19, 553503708701.86, 541440613073.64,
      530286923303.66, 519950919467.44, 510353842407.28,
      501427686348.92, 493113437720.23, 484074786193.61,
      478121333143.78, 471358936327.06, 465037653845.78,
      459126747449.31, 453599023283.05, 448430388622.18,
      443599480377.26, 439087352857.46, 434877214846.06,
      431361401332.87, 427305220575.04, 423918730328.15,
      420784674297.91, 417894340462.60, 415240279798.58,
      412816236436.15, 410617094526.91, 408638840847.23,
      406878542591.41, 405334340227.07
      ], index=pd.RangeIndex(start=2014, stop=2061))
  result = fc.soln_pds_install_cost_per_iunit(soln_pds_tot_iunits_req, [])
  pd.testing.assert_series_equal(result,
      expected_soln_pds_install_cost_per_iunit,
      check_exact=False, check_less_precise=12)


def test_conv_ref_install_cost_per_iunit_SolarPV_27Aug18():
  """Test conventional install cost per unit

     Values taken from SolarPVUtility_RRS_ELECGEN_v1.1d_27Aug18
  """
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  conv_ref_tot_iunits_req = pd.Series([
      4.53535289538464, 4.8796378165883, 5.05302431141252,
      5.2263750432106, 5.39969647677689, 5.57299507690575,
      5.74627730839152, 5.91954963602856, 6.09281852461121,
      6.26609043893384, 6.43937184379078, 6.61266920397639,
      6.78598898428503, 6.95933764951104, 7.13272166444877,
      7.30614749389258, 7.47962160263682, 7.65315045547583,
      7.82674051720397, 8.00039825261559, 8.17413012650505,
      8.34794260366669, 8.52184214889486, 8.69583522698391,
      8.8699283027282, 9.04412784092207, 9.21844030635989,
      9.39287216383599, 9.56742987814473, 9.74211991408047,
      9.91694873643755, 10.0919228100103, 10.2670485995931,
      10.4423325699803, 10.6177811859663, 10.7934009123454,
      10.9691982139119, 11.1451795554602, 11.3213514017846,
      11.4977202176796, 11.6742924679394, 11.8510746173584,
      12.028073130731, 12.2052944728515, 12.3827451085142,
      12.5604315025136, 12.7383601196439
      ], index=pd.RangeIndex(start=2014, stop=2061))
  expected_conv_ref_install_cost_per_iunit = pd.Series([
      # we added a 2014 value, the rest are from Excel
      2010031708519.64, 2005749716919.21, 2003709559856.43,
      2001740610594.36, 1999838071911.36, 1997997609222.97,
      1996215293069.34, 1994487550260.54, 1992811122162.61,
      1991183028908.37, 1989600538551.80, 1988061140369.17,
      1986562521656.05, 1985102547485.31, 1983679242984.24,
      1982290777764.18, 1980935452196.45, 1979611685278.25,
      1978318003872.66, 1977053033140.28, 1975815488007.72,
      1974604165541.04, 1973417938111.52, 1972255747256.95,
      1971116598155.42, 1969999554639.64, 1968903734689.63,
      1967828306349.86, 1966772484023.75, 1965735525104.47,
      1964716726906.07, 1963715423863.49, 1962730984973.61,
      1961762811452.90, 1960810334590.08, 1959873013774.63,
      1958950334684.14, 1958041807615.42, 1957146965945.90,
      1956265364713.38, 1955396579303.22, 1954540204233.54,
      1953695852029.72, 1952863152180.40, 1952041750168.08,
      1951231306567.92, 1950431496209.24
      ], index=pd.RangeIndex(start=2014, stop=2061))
  result = fc.conv_ref_install_cost_per_iunit(conv_ref_tot_iunits_req)
  pd.testing.assert_series_equal(result,
      expected_conv_ref_install_cost_per_iunit,
      check_exact=False, check_less_precise=12)


def test_soln_pds_install_cost_per_iunit_SolarPV_27Aug18_not_less_conv():
  """Test PDS install cost per unit

     Values taken from SolarPVUtility_RRS_ELECGEN_v1.1d_27Aug18
  """
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=False,  # result == conv_ref_install_cost_per_iunit
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_pds_tot_iunits_req = pd.Series([
      0.061158144891382, 0.0956963287565992, 0.147709178675075,
      0.208131559430844, 0.276585853638905, 0.352694443914253,
      0.355112754893078, 0.526364043126798, 0.623169817293988,
      0.726119417988453, 0.834835227825188, 0.866279647028161,
      1.06805500538546, 1.19180373833898, 1.31980821089477,
      1.4516908056678, 1.65078562297544, 1.72557989232562,
      1.8668311494404, 2.01045005923242, 2.15605900431668,
      2.30328036730816, 2.45173653082188, 2.60104987747283,
      2.75084278987599, 2.90073765064638, 3.07612351532151,
      3.1993227477488, 3.34725774931083, 3.49378422970006,
      3.6385245715315, 3.78110115742013, 3.92113636998096,
      4.05825259182899, 4.1920722055792, 4.3222175938466,
      4.43499993794447, 4.56997522439294, 4.68683223190188,
      4.79850454438799, 4.90461454446626, 5.00478461475171,
      5.09863713785931, 5.18579449640408, 5.265879073001,
      5.33851325026507, 5.40331941081129
      ], index=pd.RangeIndex(start=2014, stop=2061))
  conv_ref_tot_iunits_req = pd.Series([
      4.53535289538464, 4.8796378165883, 5.05302431141252,
      5.2263750432106, 5.39969647677689, 5.57299507690575,
      5.74627730839152, 5.91954963602856, 6.09281852461121,
      6.26609043893384, 6.43937184379078, 6.61266920397639,
      6.78598898428503, 6.95933764951104, 7.13272166444877,
      7.30614749389258, 7.47962160263682, 7.65315045547583,
      7.82674051720397, 8.00039825261559, 8.17413012650505,
      8.34794260366669, 8.52184214889486, 8.69583522698391,
      8.8699283027282, 9.04412784092207, 9.21844030635989,
      9.39287216383599, 9.56742987814473, 9.74211991408047,
      9.91694873643755, 10.0919228100103, 10.2670485995931,
      10.4423325699803, 10.6177811859663, 10.7934009123454,
      10.9691982139119, 11.1451795554602, 11.3213514017846,
      11.4977202176796, 11.6742924679394, 11.8510746173584,
      12.028073130731, 12.2052944728515, 12.3827451085142,
      12.5604315025136, 12.7383601196439
      ], index=pd.RangeIndex(start=2014, stop=2061))
  expected_soln_pds_install_cost_per_iunit = pd.Series([
      2010031708519.64, 2005749716919.21, 2003709559856.43,
      2001740610594.36, 1999838071911.36, 1997997609222.97,
      1996215293069.34, 1994487550260.54, 1992811122162.61,
      1991183028908.37, 1989600538551.80, 1988061140369.17,
      1986562521656.05, 1985102547485.31, 1983679242984.24,
      1982290777764.18, 1980935452196.45, 1979611685278.25,
      1978318003872.66, 1977053033140.28, 1975815488007.72,
      1974604165541.04, 1973417938111.52, 1972255747256.95,
      1971116598155.42, 1969999554639.64, 1968903734689.63,
      1967828306349.86, 1966772484023.75, 1965735525104.47,
      1964716726906.07, 1963715423863.49, 1962730984973.61,
      1961762811452.90, 1960810334590.08, 1959873013774.63,
      1958950334684.14, 1958041807615.42, 1957146965945.90,
      1956265364713.38, 1955396579303.22, 1954540204233.54,
      1953695852029.72, 1952863152180.40, 1952041750168.08,
      1951231306567.92, 1950431496209.24
      ], index=pd.RangeIndex(start=2014, stop=2061))
  result = fc.soln_pds_install_cost_per_iunit(soln_pds_tot_iunits_req,
      conv_ref_tot_iunits_req)
  pd.testing.assert_series_equal(result, expected_soln_pds_install_cost_per_iunit,
      check_exact=False, check_less_precise=12)

def test_soln_ref_install_cost_per_iunit_SolarPV_27Aug18():
  """Test PDS install cost per unit

     Values taken from SolarPVUtility_RRS_ELECGEN_v1.1d_27Aug18
  """
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_ref_tot_iunits_req = pd.Series([
      0.061158144891382, 0.0635681132081653, 0.0659780815249495,
      0.0683880498417336, 0.0707980181585176, 0.0732079864753018,
      0.0756179547920859, 0.07802792310887, 0.0804378914256541,
      0.0828478597424382, 0.0852578280592223, 0.0876677963760064,
      0.0900777646927905, 0.0924877330095746, 0.0948977013263587,
      0.0973076696431428, 0.0997176379599269, 0.102127606276711,
      0.104537574593495, 0.106947542910279, 0.109357511227062,
      0.111767479543846, 0.114177447860631, 0.116587416177415,
      0.118997384494199, 0.121407352810983, 0.123817321127767,
      0.126227289444551, 0.128637257761335, 0.131047226078119,
      0.133457194394903, 0.135867162711687, 0.138277131028472,
      0.140687099345256, 0.14309706766204, 0.145507035978824,
      0.147917004295608, 0.150326972612392, 0.152736940929176,
      0.15514690924596, 0.157556877562744, 0.159966845879528,
      0.162376814196313, 0.164786782513097, 0.167196750829881,
      0.169606719146665, 0.172016687463449],
      index=pd.RangeIndex(start=2014, stop=2061))
  conv_ref_tot_iunits_req = pd.Series([
      4.53535289538464, 4.8796378165883, 5.05302431141252,
      5.2263750432106, 5.39969647677689, 5.57299507690575,
      5.74627730839152, 5.91954963602856, 6.09281852461121,
      6.26609043893384, 6.43937184379078, 6.61266920397639,
      6.78598898428503, 6.95933764951104, 7.13272166444877,
      7.30614749389258, 7.47962160263682, 7.65315045547583,
      7.82674051720397, 8.00039825261559, 8.17413012650505,
      8.34794260366669, 8.52184214889486, 8.69583522698391,
      8.8699283027282, 9.04412784092207, 9.21844030635989,
      9.39287216383599, 9.56742987814473, 9.74211991408047,
      9.91694873643755, 10.0919228100103, 10.2670485995931,
      10.4423325699803, 10.6177811859663, 10.7934009123454,
      10.9691982139119, 11.1451795554602, 11.3213514017846,
      11.4977202176796, 11.6742924679394, 11.8510746173584,
      12.028073130731, 12.2052944728515, 12.3827451085142,
      12.5604315025136, 12.7383601196439],
      index=pd.RangeIndex(start=2014, stop=2061))
  expected_soln_ref_install_cost_per_iunit = pd.Series([
      1462645781446.20,
      1444939544214.85, 1428094804476.74, 1412040401146.06,
      1396713300701.40, 1382057429062.81, 1368022703608.46,
      1354564225858.61, 1341641604099.87, 1329218381829.52,
      1317261552938.43, 1305741148426.15, 1294629882446.35,
      1283902847828.80, 1273537253070.73, 1263512194254.57,
      1253808456515.32, 1244408340617.21, 1235295510953.90,
      1226454861899.16, 1217872399934.28, 1209535139387.41,
      1201431009956.79, 1193548774468.46, 1185877955550.05,
      1178408770095.09, 1171132070553.72, 1164039292221.12,
      1157122405809.40, 1150373874685.44, 1143786616238.99,
      1137353966915.75, 1131069650509.32, 1124927749357.55,
      1118922678132.44, 1113049159950.79, 1107302204565.43,
      1101677088425.20, 1096169336416.45, 1090774705120.23,
      1085489167437.89, 1080308898454.35, 1075230262422.28,
      1070249800763.29, 1065364220992.90, 1060570386486.19,
      1055865307009.23],
      index=pd.RangeIndex(start=2014, stop=2061))
  result = fc.soln_ref_install_cost_per_iunit(soln_ref_tot_iunits_req,
      conv_ref_tot_iunits_req)
  pd.testing.assert_series_equal(result,
      expected_soln_ref_install_cost_per_iunit,
      check_exact=False, check_less_precise=12)

def test_soln_ref_install_cost_per_iunit_SolarPV_27Aug18_not_less_conv():
  """Test PDS install cost per unit

     Values taken from SolarPVUtility_RRS_ELECGEN_v1.1d_27Aug18
  """
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=False,  # result = conv
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_ref_tot_iunits_req = pd.Series([
      0.061158144891382, 0.0635681132081653, 0.0659780815249495,
      0.0683880498417336, 0.0707980181585176, 0.0732079864753018,
      0.0756179547920859, 0.07802792310887, 0.0804378914256541,
      0.0828478597424382, 0.0852578280592223, 0.0876677963760064,
      0.0900777646927905, 0.0924877330095746, 0.0948977013263587,
      0.0973076696431428, 0.0997176379599269, 0.102127606276711,
      0.104537574593495, 0.106947542910279, 0.109357511227062,
      0.111767479543846, 0.114177447860631, 0.116587416177415,
      0.118997384494199, 0.121407352810983, 0.123817321127767,
      0.126227289444551, 0.128637257761335, 0.131047226078119,
      0.133457194394903, 0.135867162711687, 0.138277131028472,
      0.140687099345256, 0.14309706766204, 0.145507035978824,
      0.147917004295608, 0.150326972612392, 0.152736940929176,
      0.15514690924596, 0.157556877562744, 0.159966845879528,
      0.162376814196313, 0.164786782513097, 0.167196750829881,
      0.169606719146665, 0.172016687463449],
      index=pd.RangeIndex(start=2014, stop=2061))
  conv_ref_tot_iunits_req = pd.Series([
      4.53535289538464, 4.8796378165883, 5.05302431141252,
      5.2263750432106, 5.39969647677689, 5.57299507690575,
      5.74627730839152, 5.91954963602856, 6.09281852461121,
      6.26609043893384, 6.43937184379078, 6.61266920397639,
      6.78598898428503, 6.95933764951104, 7.13272166444877,
      7.30614749389258, 7.47962160263682, 7.65315045547583,
      7.82674051720397, 8.00039825261559, 8.17413012650505,
      8.34794260366669, 8.52184214889486, 8.69583522698391,
      8.8699283027282, 9.04412784092207, 9.21844030635989,
      9.39287216383599, 9.56742987814473, 9.74211991408047,
      9.91694873643755, 10.0919228100103, 10.2670485995931,
      10.4423325699803, 10.6177811859663, 10.7934009123454,
      10.9691982139119, 11.1451795554602, 11.3213514017846,
      11.4977202176796, 11.6742924679394, 11.8510746173584,
      12.028073130731, 12.2052944728515, 12.3827451085142,
      12.5604315025136, 12.7383601196439],
      index=pd.RangeIndex(start=2014, stop=2061))
  expected_soln_ref_install_cost_per_iunit = pd.Series([
      2010031708519.64,
      2005749716919.21, 2003709559856.43, 2001740610594.36,
      1999838071911.36, 1997997609222.97, 1996215293069.34,
      1994487550260.54, 1992811122162.61, 1991183028908.37,
      1989600538551.80, 1988061140369.17, 1986562521656.05,
      1985102547485.31, 1983679242984.24, 1982290777764.18,
      1980935452196.45, 1979611685278.25, 1978318003872.66,
      1977053033140.28, 1975815488007.72, 1974604165541.04,
      1973417938111.52, 1972255747256.95, 1971116598155.42,
      1969999554639.64, 1968903734689.63, 1967828306349.86,
      1966772484023.75, 1965735525104.47, 1964716726906.07,
      1963715423863.49, 1962730984973.61, 1961762811452.90,
      1960810334590.08, 1959873013774.63, 1958950334684.14,
      1958041807615.42, 1957146965945.90, 1956265364713.38,
      1955396579303.22, 1954540204233.54, 1953695852029.72,
      1952863152180.40, 1952041750168.08, 1951231306567.92,
      1950431496209.24], index=pd.RangeIndex(start=2014, stop=2061))
  result = fc.soln_ref_install_cost_per_iunit(soln_ref_tot_iunits_req,
      conv_ref_tot_iunits_req)
  pd.testing.assert_series_equal(result,
      expected_soln_ref_install_cost_per_iunit,
      check_exact=False, check_less_precise=12)


def test_soln_pds_annual_world_first_cost_SolarPV_27Aug18():
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_pds_new_iunits_req = pd.Series([
      0.0345381838652173, 0.0520128499184754, 0.0604223807557696,
      0.0684542942080606, 0.0761085902753482, 0.00241831097882528,
      0.17125128823372, 0.0968057741671903, 0.102949600694464,
      0.108715809836735, 0.0314444192029726, 0.201775358357296,
      0.123748732953527, 0.128004472555784, 0.131882594773037,
      0.199094817307635, 0.0747942693501868, 0.141251257114778,
      0.143618909792018, 0.145608945084255, 0.147221362991488,
      0.148456163513718, 0.149313346650944, 0.149792912403169,
      0.149894860770387, 0.175385864675128, 0.123199232427293,
      0.182473185427243, 0.198539330307708, 0.205162722587205,
      0.211030880096696, 0.216143802836179, 0.139534532826849,
      0.305070901983933, 0.22695116243459, 0.215731944792336,
      0.243691096285204, 0.148301426711909, 0.313447670843405,
      0.229858733031804, 0.228174542841226, 0.225735117880642,
      0.286252175852399, 0.154878845947108, 0.213885434378849,
      0.208425070338238], index=pd.RangeIndex(start=2015, stop=2061))
  soln_pds_install_cost_per_iunit = pd.Series([
      1444939544214.85, 1260211854559.48, 1131125771261.71, 1034176540754.27,
      957914360042.17, 955853826404.52, 844363092072.89, 800615041745.80,
      762954261503.24, 730136123170.93, 721678325520.19, 675595934758.92,
      652654395751.15, 632005749879.43, 613318626692.05, 588974654797.70,
      580807336513.56, 566583683816.19, 553503708701.86, 541440613073.64,
      530286923303.66, 519950919467.44, 510353842407.28, 501427686348.92,
      493113437720.23, 484074786193.61, 478121333143.78, 471358936327.06,
      465037653845.78, 459126747449.31, 453599023283.05, 448430388622.18,
      443599480377.26, 439087352857.46, 434877214846.06, 431361401332.87,
      427305220575.04, 423918730328.15, 420784674297.91, 417894340462.60,
      415240279798.58, 412816236436.15, 410617094526.91, 408638840847.23,
      406878542591.41, 405334340227.07
      ], index=pd.RangeIndex(start=2015, stop=2061))
  expected_soln_pds_annual_world_first_cost = pd.Series([
      49905587652.22, 65547210056.69, 68345312033.84,
      70793825183.87, 72905511547.32, 2311551802.55,
      144598267254.49, 77504158926.10, 78545836569.90,
      79377339921.58, 22692755797.36, 136318611840.71,
      80765154530.75, 80899562665.54, 80886051910.78,
      117261801295.78, 43441060367.76, 80030657599.76,
      79493599209.60, 78838596495.43, 78069563625.33,
      77189918719.57, 76202640186.00, 75110313497.79,
      73915170091.08, 84899874943.99, 58904181250.43,
      86010366591.19, 92328264362.41, 94195693519.31,
      95723401094.42, 96925449504.10, 61897446256.67,
      133952774785.96, 98695889425.63, 93058434017.89,
      104130477650.32, 62867752517.57, 131893976085.28,
      96056663639.89, 94747261012.30, 93187121794.96,
      117540036750.52, 63289512079.58, 87025393821.60,
      84481838372.33
      ], index=pd.RangeIndex(start=2015, stop=2061))
  result = fc.soln_pds_annual_world_first_cost(
      soln_pds_new_iunits_req=soln_pds_new_iunits_req,
      soln_pds_install_cost_per_iunit=soln_pds_install_cost_per_iunit)
  pd.testing.assert_series_equal(result,
      expected_soln_pds_annual_world_first_cost,
      check_exact=False)


def test_soln_pds_cumulative_install_SolarPV_27Aug18():
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_pds_annual_world_first_cost = pd.Series([
      49905587652.22, 65547210056.69, 68345312033.84,
      70793825183.87, 72905511547.32, 2311551802.55,
      144598267254.49, 77504158926.10, 78545836569.90,
      79377339921.58, 22692755797.36, 136318611840.71,
      80765154530.75, 80899562665.54, 80886051910.78,
      117261801295.78, 43441060367.76, 80030657599.76,
      79493599209.60, 78838596495.43, 78069563625.33,
      77189918719.57, 76202640186.00, 75110313497.79,
      73915170091.08, 84899874943.99, 58904181250.43,
      86010366591.19, 92328264362.41, 94195693519.31,
      95723401094.42, 96925449504.10, 61897446256.67,
      133952774785.96, 98695889425.63, 93058434017.89,
      104130477650.32, 62867752517.57, 131893976085.28,
      96056663639.89, 94747261012.30, 93187121794.96,
      117540036750.52, 63289512079.58, 87025393821.60,
      84481838372.33],
      index=pd.RangeIndex(start=2015, stop=2061))
  expected_soln_pds_cumulative_install = pd.Series([
      49905587652.22, 115452797708.90, 183798109742.74,
      254591934926.61, 327497446473.93, 329808998276.48,
      474407265530.97, 551911424457.07, 630457261026.96,
      709834600948.55, 732527356745.90, 868845968586.61,
      949611123117.37, 1030510685782.91, 1111396737693.69,
      1228658538989.46, 1272099599357.22, 1352130256956.98,
      1431623856166.58, 1510462452662.01, 1588532016287.33,
      1665721935006.90, 1741924575192.90, 1817034888690.69,
      1890950058781.77, 1975849933725.76, 2034754114976.19,
      2120764481567.39, 2213092745929.79, 2307288439449.10,
      2403011840543.53, 2499937290047.63, 2561834736304.30,
      2695787511090.27, 2794483400515.90, 2887541834533.78,
      2991672312184.11, 3054540064701.67, 3186434040786.95,
      3282490704426.85, 3377237965439.15, 3470425087234.11,
      3587965123984.63, 3651254636064.21, 3738280029885.81,
      3822761868258.14],
      index=pd.RangeIndex(start=2015, stop=2061))
  result = fc.soln_pds_cumulative_install(
      soln_pds_annual_world_first_cost=soln_pds_annual_world_first_cost)
  pd.testing.assert_series_equal(result,
      expected_soln_pds_cumulative_install,
      check_exact=False)


def test_soln_ref_annual_world_first_cost_SolarPV_27Aug18():
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_ref_new_iunits_req = pd.Series([
      0.0345381838652173, 0.0520128499184754, 0.0604223807557696,
      0.0684542942080606, 0.0761085902753482, 0.00241831097882528,
      0.17125128823372, 0.0968057741671903, 0.102949600694464,
      0.108715809836735, 0.0314444192029726, 0.201775358357296,
      0.123748732953527, 0.128004472555784, 0.131882594773037,
      0.199094817307635, 0.0747942693501868, 0.141251257114778,
      0.143618909792018, 0.145608945084255, 0.147221362991488,
      0.148456163513718, 0.149313346650944, 0.149792912403169,
      0.149894860770387, 0.175385864675128, 0.123199232427293,
      0.182473185427243, 0.198539330307708, 0.205162722587205,
      0.211030880096696, 0.216143802836179, 0.139534532826849,
      0.305070901983933, 0.22695116243459, 0.215731944792336,
      0.243691096285204, 0.148301426711909, 0.313447670843405,
      0.229858733031804, 0.228174542841226, 0.225735117880642,
      0.286252175852399, 0.154878845947108, 0.213885434378849,
      0.208425070338238],
      index=pd.RangeIndex(start=2015, stop=2061))
  soln_ref_install_cost_per_iunit = pd.Series([
      1444939544214.85, 1260211854559.48, 1131125771261.71, 1034176540754.27,
      957914360042.17, 955853826404.52, 844363092072.89, 800615041745.80,
      762954261503.24, 730136123170.93, 721678325520.19, 675595934758.92,
      652654395751.15, 632005749879.43, 613318626692.05, 588974654797.70,
      580807336513.56, 566583683816.19, 553503708701.86, 541440613073.64,
      530286923303.66, 519950919467.44, 510353842407.28, 501427686348.92,
      493113437720.23, 484074786193.61, 478121333143.78, 471358936327.06,
      465037653845.78, 459126747449.31, 453599023283.05, 448430388622.18,
      443599480377.26, 439087352857.46, 434877214846.06, 431361401332.87,
      427305220575.04, 423918730328.15, 420784674297.91, 417894340462.60,
      415240279798.58, 412816236436.15, 410617094526.91, 408638840847.23,
      406878542591.41, 405334340227.07
      ], index=pd.RangeIndex(start=2015, stop=2061))
  expected_soln_ref_annual_world_first_cost = pd.Series([
      49905587652.22, 65547210056.69, 68345312033.84,
      70793825183.87, 72905511547.32, 2311551802.55,
      144598267254.49, 77504158926.10, 78545836569.90,
      79377339921.58, 22692755797.36, 136318611840.71,
      80765154530.75, 80899562665.54, 80886051910.78,
      117261801295.78, 43441060367.76, 80030657599.76,
      79493599209.60, 78838596495.43, 78069563625.33,
      77189918719.57, 76202640186.00, 75110313497.79,
      73915170091.08, 84899874943.99, 58904181250.43,
      86010366591.19, 92328264362.41, 94195693519.31,
      95723401094.42, 96925449504.10, 61897446256.67,
      133952774785.96, 98695889425.63, 93058434017.89,
      104130477650.32, 62867752517.57, 131893976085.28,
      96056663639.89, 94747261012.30, 93187121794.96,
      117540036750.52, 63289512079.58, 87025393821.60,
      84481838372.33],
      index=pd.RangeIndex(start=2015, stop=2061))
  result = fc.soln_ref_annual_world_first_cost(
      soln_ref_new_iunits_req=soln_ref_new_iunits_req,
      soln_ref_install_cost_per_iunit=soln_ref_install_cost_per_iunit)
  pd.testing.assert_series_equal(result,
      expected_soln_ref_annual_world_first_cost,
      check_exact=False)

def test_conv_ref_annual_world_first_cost_SolarPV_27Aug18():
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  conv_ref_new_iunits_req = pd.Series([
      0.011961075, 0.018466751, 0.021597552, 0.024587768,
      0.027437401, 3.10591E-06, 0.062858257, 0.035142795,
      0.037430092, 0.039576805, 0.010809291, 0.074222121,
      0.04517344, 0.046757818, 0.048201611, 0.073224178,
      0.02694809, 0.051689488, 0.052570946, 0.05331182,
      0.05391211, 0.054371817, 0.054690939, 0.054869477,
      0.054907432, 0.064397526, 0.044968866, 0.054177792,
      0.053653411, 0.052988446, 0.052182897, 0.051236765,
      0.050150048, 0.048922748, 0.047554863, 0.041090742,
      0.049352995, 0.042607707, 0.052638561, 0.057073434,
      0.057992847, 0.058631091, 0.058988168, 0.028920734,
      0.089002162, 0.058372392
      ], index=pd.RangeIndex(start=2015, stop=2061))
  conv_ref_install_cost_per_iunit = pd.Series([
      2005749716919.21, 2003709559856.43, 2001740610594.36,
      1999838071911.36, 1997997609222.97, 1996215293069.34,
      1994487550260.54, 1992811122162.61, 1991183028908.37,
      1989600538551.80, 1988061140369.17, 1986562521656.05,
      1985102547485.31, 1983679242984.24, 1982290777764.18,
      1980935452196.45, 1979611685278.25, 1978318003872.66,
      1977053033140.28, 1975815488007.72, 1974604165541.04,
      1973417938111.51, 1972255747256.95, 1971116598155.42,
      1969999554639.64, 1968903734689.63, 1967828306349.86,
      1966772484023.75, 1965735525104.47, 1964716726906.07,
      1963715423863.49, 1962730984973.61, 1961762811452.90,
      1960810334590.08, 1959873013774.63, 1958950334684.14,
      1958041807615.42, 1957146965945.90, 1956265364713.38,
      1955396579303.22, 1954540204233.54, 1953695852029.72,
      1952863152180.40, 1952041750168.08, 1951231306567.92,
      1950431496209.24
      ], index=pd.RangeIndex(start=2015, stop=2061))
  expected_conv_ref_annual_world_first_cost = pd.Series([
      23990922121.35, 37002006377.58, 43232696345.06,
      49171554733.95, 54819860759.44, 6200056.19,
      125370011265.80, 70032952058.20, 74530163079.95,
      78742031667.77, 21489531621.24, 147446884706.03,
      89673911197.87, 92752512230.40, 95549609205.27,
      145052369536.31, 53346752937.10, 102258245318.98,
      103935548708.06, 105334320183.91, 106455077787.31,
      107298318307.97, 107864518760.06, 108154137726.00,
      108167616582.81, 126792530383.75, 88491006611.85,
      106555391090.20, 105468416516.60, 104107286794.25,
      102472360643.17, 100563985754.45, 98382499420.65,
      95928229120.13, 93201493059.41, 80494723496.87,
      96635227949.86, 83389543648.21, 102974994195.43,
      111601197813.73, 113349350213.04, 114547319830.92,
      115195820046.09, 56454480248.00, 173663804562.34,
      113851352078.09
      ], index=pd.RangeIndex(start=2015, stop=2061))
  result = fc.conv_ref_annual_world_first_cost(
      conv_ref_new_iunits_req=conv_ref_new_iunits_req,
      conv_ref_install_cost_per_iunit=conv_ref_install_cost_per_iunit)
  pd.testing.assert_series_equal(result,
      expected_conv_ref_annual_world_first_cost,
      check_exact=False)


def test_ref_cumulative_install_SolarPV_27Aug18():
  ac = advanced_controls.AdvancedControls(
      pds_2014_cost=1444.93954421485,
      ref_2014_cost=1444.93954421485,
      conv_2014_cost=2010.03170851964,
      soln_first_cost_efficiency_rate=0.196222222222222,
      soln_first_cost_below_conv=True,
      conv_first_cost_efficiency_rate=0.02)
  fc = firstcost.FirstCost(
      ac, pds_learning_increase_mult=2, ref_learning_increase_mult=2,
      conv_learning_increase_mult=2)
  soln_ref_annual_world_first_cost = pd.Series([
      3482258521.23, 3441663232.15, 3402972628.78,
      3366034802.32, 3330714616.02, 3296891372.34,
      3264456867.37, 3233313758.36, 3203374186.30,
      3174558607.50, 3146794797.63, 3120016998.66,
      3094165185.10, 3069184430.14, 3045024356.02,
      3021638655.52, 2998984674.03, 2977023043.26,
      2955717359.14, 2935033897.73, 2914941363.96,
      2895410668.80, 2876414731.01, 2857928300.45,
      2839927800.15, 2822391184.80, 2805297813.74,
      5577256673.28, 5544729180.90, 5512979012.60,
      5481974050.47, 5451684043.61, 5422080469.25,
      5393136406.46, 5364826421.01, 5337126460.22,
      5310013756.86, 5283466741.19, 5257464960.18,
      5231989003.48, 5207020435.23, 5182541731.37,
      5158536221.77, 5134988036.86, 5111882058.30,
      5089203873.37
      ], index=pd.RangeIndex(start=2015, stop=2061))
  conv_ref_annual_world_first_cost = pd.Series([
      23990922121.35, 37002006377.58, 43232696345.06,
      49171554733.95, 54819860759.44, 6200056.19,
      125370011265.80, 70032952058.20, 74530163079.95,
      78742031667.77, 21489531621.24, 147446884706.03,
      89673911197.87, 92752512230.40, 95549609205.27,
      145052369536.31, 53346752937.10, 102258245318.98,
      103935548708.06, 105334320183.91, 106455077787.31,
      107298318307.97, 107864518760.06, 108154137726.00,
      108167616582.81, 126792530383.75, 88491006611.85,
      106555391090.20, 105468416516.60, 104107286794.25,
      102472360643.17, 100563985754.45, 98382499420.65,
      95928229120.13, 93201493059.41, 80494723496.87,
      96635227949.86, 83389543648.21, 102974994195.43,
      111601197813.73, 113349350213.04, 114547319830.92,
      115195820046.09, 56454480248.00, 173663804562.34,
      113851352078.09
      ], index=pd.RangeIndex(start=2015, stop=2061))
  expected_ref_cumulative_install = pd.Series([
      27473180642.58, 67916850252.30, 114552519226.14,
      167090108762.41, 225240684137.87, 228543775566.41,
      357178243699.58, 430444509516.14, 508178046782.39,
      590094637057.66, 614730963476.53, 765297865181.21,
      858065941564.18, 953887638224.72, 1052482271786.01,
      1200556279977.84, 1256902017588.96, 1362137285951.21,
      1469028552018.41, 1577297906100.04, 1686667925251.31,
      1796861654228.08, 1907602587719.15, 2018614653745.60,
      2129622198128.56, 2259237119697.11, 2350533424122.71,
      2462666071886.19, 2573679217583.69, 2683299483390.53,
      2791253818084.18, 2897269487882.23, 3001074067772.13,
      3102395433298.72, 3200961752779.14, 3286793602736.23,
      3388738844442.95, 3477411854832.34, 3585644313987.95,
      3702477500805.16, 3821033871453.43, 3940763733015.72,
      4061118089283.58, 4122707557568.43, 4301483244189.08,
      4420423800140.54
      ], index=pd.RangeIndex(start=2015, stop=2061))
  result = fc.ref_cumulative_install(
      soln_ref_annual_world_first_cost=soln_ref_annual_world_first_cost,
      conv_ref_annual_world_first_cost=conv_ref_annual_world_first_cost)
  pd.testing.assert_series_equal(result,
      expected_ref_cumulative_install,
      check_exact=False)
