"""Tests for adoptiondata.py."""

import numpy as np
import pandas as pd
import pytest
from model import adoptiondata as ad


def test_adoption_data():
  adopt = ad.adoption(adoption_data_filename='solarpvutil_adoptiondata.csv')
  assert adopt['Based on: IEA ETP 2016 4DS'][2035] == pytest.approx(898.010968835815)
  assert adopt['Based on: Greenpeace (2015) Reference'][2027] == pytest.approx(327.712635691309)

def test_adoption_min_max_sd():
  adoption = ad.adoption(adoption_data_filename='solarpvutil_adoptiondata.csv')
  result = ad.adoption_min_max_sd(adoption)
  expected = pd.DataFrame(adoption_min_max_sd_list[1:], columns=adoption_min_max_sd_list[0],
      dtype=np.float64).set_index('Year')
  expected.index = expected.index.astype(int)
  pd.testing.assert_frame_equal(result, expected, check_exact=False)

def test_adoption_low_med_high():
  adoption = ad.adoption(adoption_data_filename='solarpvutil_adoptiondata.csv')
  adoption_min_max_sd = pd.DataFrame(adoption_min_max_sd_list[1:],
      columns=adoption_min_max_sd_list[0], dtype=np.float64).set_index('Year')
  adoption_min_max_sd.index = adoption_min_max_sd.index.astype(int)
  source = ['Based on: Greenpeace (2015) Advanced Energy Revolution']
  result = ad.adoption_low_med_high(adoption=adoption, adoption_prognostication_source=source,
      adoption_min_max_sd=adoption_min_max_sd, low_sd=1, high_sd=1)
  expected = pd.DataFrame(adoption_low_med_high_list[1:], columns=adoption_low_med_high_list[0],
      dtype=np.float64).set_index('Year')
  expected.index = expected.index.astype(int)
  pd.testing.assert_frame_equal(result, expected, check_exact=False)


# 'Adoption Data'!X46:Z94
adoption_min_max_sd_list = [['Year', 'Min', 'Max', 'S.D'],
    [2012, 58.200000, 58.200000, 0.000000], [2013, 81.060000, 81.060000, 0.000000],
    [2014, 112.633033, 112.633033, 0.000000], [2015, 94.240258, 218.061459, 37.837223],
    [2016, 115.457997, 272.031352, 50.912757], [2017, 139.360289, 383.309352, 70.927561],
    [2018, 166.022587, 509.379474, 96.404783], [2019, 194.474873, 649.546273, 126.360959],
    [2020, 203.777863, 654.000000, 153.513406], [2021, 228.265871, 969.388115, 197.441518],
    [2022, 245.065460, 1147.672267, 237.818374], [2023, 261.788054, 1337.271311, 281.018215],
    [2024, 278.423860, 1537.489801, 326.789074], [2025, 311.400000, 1595.400000, 330.239857],
    [2026, 311.395943, 1967.003336, 425.141105], [2027, 327.712636, 2194.907488, 477.295159],
    [2028, 343.903374, 2430.649302, 531.153951], [2029, 359.958367, 2673.533332, 586.543088],
    [2030, 378.000000, 3040.200000, 679.160229], [2031, 391.621946, 3177.946255, 701.160954],
    [2032, 407.210949, 3438.084256, 760.063844], [2033, 422.625039, 3702.582689, 819.816148],
    [2034, 437.854424, 3970.746106, 880.277085], [2035, 452.889312, 4241.879064, 947.307160],
    [2036, 467.719912, 4515.286114, 1002.844241], [2037, 482.336431, 4790.271812, 1064.718473],
    [2038, 496.729079, 5066.140711, 1126.868629], [2039, 510.888062, 5342.197365, 1189.231979],
    [2040, 499.200000, 5665.200000, 1270.356939], [2041, 538.465871, 5892.092154, 1314.377567],
    [2042, 551.865113, 6164.539397, 1377.118694], [2043, 564.991524, 6434.392611, 1439.986601],
    [2044, 577.835313, 6700.956350, 1503.012843], [2045, 590.386687, 6963.535167, 1561.352973],
    [2046, 602.635855, 7221.433617, 1629.833623], [2047, 614.573025, 7473.956253, 1693.843531],
    [2048, 626.188406, 7720.407630, 1758.440240], [2049, 637.472206, 7960.092301, 1823.822675],
    [2050, 657.600000, 8167.800000, 1883.358921], [2051, 659.005894, 8416.379743, 1959.040916],
    [2052, 669.236199, 8631.591621, 2027.012498], [2053, 679.095755, 8837.255009, 2098.064244],
    [2054, 688.574772, 9032.674462, 2171.344027], [2055, 697.663457, 9217.154532, 2247.244231],
    [2056, 706.352018, 9389.999774, 2326.194035], [2057, 714.630664, 9550.514742, 2408.641031],
    [2058, 722.489603, 9698.003990, 2495.073624], [2059, 729.919043, 9831.772071, 2586.001183],
    [2060, 736.909192, 9951.123540, 2681.954064]]

# 'Adoption Data'!AB46:AD94
adoption_low_med_high_list = [['Year', 'Low', 'Medium', 'High'],
    [2012, 58.200000, 58.200000, 58.200000], [2013, 81.060000, 81.060000, 81.060000],
    [2014, 112.633033, 112.633033, 112.633033], [2015, 138.403698, 176.240921, 214.078144],
    [2016, 221.118595, 272.031352, 322.944109], [2017, 312.381791, 383.309352, 454.236913],
    [2018, 412.974691, 509.379474, 605.784256], [2019, 523.185314, 649.546273, 775.907231],
    [2020, 500.486594, 654.000000, 807.513406], [2021, 771.946597, 969.388115, 1166.829634],
    [2022, 909.853893, 1147.672267, 1385.490641], [2023, 1056.253096, 1337.271311, 1618.289526],
    [2024, 1210.700727, 1537.489801, 1864.278876], [2025, 1265.160143, 1595.400000, 1925.639857],
    [2026, 1541.862231, 1967.003336, 2392.144441], [2027, 1717.612329, 2194.907488, 2672.202647],
    [2028, 1899.495352, 2430.649302, 2961.803253], [2029, 2086.990245, 2673.533332, 3260.076420],
    [2030, 2361.039771, 3040.200000, 3719.360229], [2031, 2476.785301, 3177.946255, 3879.107210],
    [2032, 2678.020412, 3438.084256, 4198.148100], [2033, 2882.766540, 3702.582689, 4522.398837],
    [2034, 3090.469022, 3970.746106, 4851.023191], [2035, 3294.571903, 4241.879064, 5189.186224],
    [2036, 3512.441874, 4515.286114, 5518.130355], [2037, 3725.553339, 4790.271812, 5854.990285],
    [2038, 3939.272082, 5066.140711, 6193.009340], [2039, 4152.965387, 5342.197365, 6531.429344],
    [2040, 4394.843061, 5665.200000, 6935.556939], [2041, 4577.714588, 5892.092154, 7206.469721],
    [2042, 4787.420703, 6164.539397, 7541.658092], [2043, 4994.406010, 6434.392611, 7874.379213],
    [2044, 5197.943507, 6700.956350, 8203.969193], [2045, 5402.182194, 6963.535167, 8524.888140],
    [2046, 5591.599994, 7221.433617, 8851.267240], [2047, 5780.112723, 7473.956253, 9167.799784],
    [2048, 5961.967390, 7720.407630, 9478.847871], [2049, 6136.269626, 7960.092301, 9783.914977],
    [2050, 6284.441079, 8167.800000, 10051.158921], [2051, 6457.338827, 8416.379743, 10375.420659],
    [2052, 6604.579123, 8631.591621, 10658.604119], [2053, 6739.190765, 8837.255009, 10935.319253],
    [2054, 6861.330435, 9032.674462, 11204.018488], [2055, 6969.910301, 9217.154532, 11464.398763],
    [2056, 7063.805739, 9389.999774, 11716.193809], [2057, 7141.873711, 9550.514742, 11959.155773],
    [2058, 7202.930366, 9698.003990, 12193.077613], [2059, 7245.770888, 9831.772071, 12417.773254],
    [2060, 7269.169476, 9951.123540, 12633.077604]]
